<!-- Generated by SpecStory -->

# como eu implemento o #codebase atual e mudo o #fil (2025-06-05 07:01:04)

_**User**_

como eu implemento o #codebase atual e mudo o #file:blog  para usar o meu repo #githubRepo https://github.com/crialabs/next-wp

---

_**Assistant**_

# Implementação de Blog Baseado no Next-WP

Para implementar um blog utilizando o repositório `next-wp` no seu projeto BadtzUI, precisamos adaptar a estrutura do blog atual para seguir o padrão do repositório GitHub que você enviou. Vou guiar você através do processo de integração.

## Passos para Implementação

### 1. Estrutura de Arquivos

Primeiro, vamos modificar a estrutura atual do seu blog para seguir o padrão do `next-wp`:

#### Ajustes na página de blog

```tsx
import Link from "next/link";
import { compareDesc } from "date-fns";
import { formatDate } from "@/lib/utils";
import { Metadata } from "next";
import { Icons } from "@/components/icons";
import BunnyImage from "@/components/bunny-image";
import { getAllPosts } from "@/lib/wordpress"; // Nova importação

export const metadata: Metadata = {
  title: "BadtzUI • Blog",
  description:
    "Welcome to our blog, where we share tips on enhancing your website's aesthetics, improving your landing page, and much more...",
  openGraph: {
    title: "BadtzUI - Modern React Components",
    images: "/og-image.png",
  },
  twitter: {
    card: "summary_large_image",
  },
  alternates: {
    canonical: "https://www.badtz-ui.com/blog",
  },
};

export default async function BlogPage() {
  // Usar a função do next-wp para buscar posts do WordPress
  const posts = await getAllPosts();
  
  // Ordenar posts por data (mais recentes primeiro)
  const sortedPosts = [...posts].sort((a, b) => {
    return compareDesc(new Date(a.date), new Date(b.date));
  });

  // Schema JSON-LD para o blog
  const jsonLdBlog = {
    "@context": "https://schema.org",
    "@type": "Blog",
    name: "BadtzUI Blog",
    description:
      "A blog where we share tips on enhancing website aesthetics, improving landing pages, and more...",
    publisher: {
      "@type": "Organization",
      name: "BadtzUI",
      logo: {
        "@type": "ImageObject",
        url: "/logo.png",
      },
    },
    url: "https://badtz-ui.com/blog",
  };

  // Schema JSON-LD para a lista de posts
  const jsonLdPosts = {
    "@context": "https://schema.org",
    "@type": "ItemList",
    name: "Blog Posts",
    itemListElement: sortedPosts.map((post, index) => ({
      "@type": "ListItem",
      position: index + 1,
      url: `https://badtz-ui.com/blog/${post.slug}`,
    })),
  };

  return (
    <div className="w-full h-full pb-16 sm:pb-28 pt-10 md:pt-16">
      <div className="px-6 lg:px-8 lg:max-w-5xl mx-auto">
        <div className="flex flex-col items-start border-b border-border pb-6">
          <div className="flex w-full justify-between gap-4 items-end">
            <h1 className="text-3xl font-semibold tracking-tighter text-foreground text-balance max-w-[605px] font-gilroy">
              Blog
            </h1>
            <Link
              href="https://x.com/badtz_ui"
              target="_blank"
              className="gap-2 px-2 md:px-3 h-8 text-[13.5px] border hover:border-foreground/10 duration-300 whitespace-nowrap shrink-0 hover:bg-sidebar-accent transition-colors flex items-center justify-center rounded [&_svg]:pointer-events-none [&_svg]:size-3 [&_svg]:shrink-0 text-foreground bg-transparent"
            >
              <Icons.twitter />
              <span className="hidden md:block font-light">Updates</span>
            </Link>
          </div>
          <p className="mt-4 text-balance max-w-[550px] md:max-w-[700px] tracking-tight text-sidebar-muted-foreground text-[15px]">
            Welcome to our blog, where we share tips on enhancing your website's aesthetics, improving your landing page, and much more...
          </p>
        </div>

        <hr className="my-3 border-none" />
        {sortedPosts?.length ? (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-2 lg:gap-4">
            {sortedPosts.map((post, index) => (
              <Link href={`/blog/${post.slug}`} key={post.id}>
                <article
                  className="flex flex-col w-full p-2 rounded-xl transition-colors duration-200 group/article"
                >
                  {post.featuredMedia && (
                    <BunnyImage
                      src={post.featuredMedia.source_url}
                      alt={post.title.rendered || "Blog post thumbnail"}
                      width={760}
                      height={400}
                      className="aspect-video object-cover bg-secondary border-border border rounded-lg"
                      priority={index <= 1}
                      quality={100}
                    />
                  )}
                  <div className="pt-2.5 p-1">
                    <h2 className="group-hover/article:text-foreground mt-2 font-medium transition-colors duration-300 text-xl text-sidebar-foreground font-gilroy">
                      {post.title.rendered}
                    </h2>
                    {post.date && (
                      <p className="text-xs text-sidebar-muted-foreground mt-1.5">
                        {formatDate(post.date)}
                      </p>
                    )}
                    {post.excerpt && (
                      <p className="mt-3 text-sm text-sidebar-muted-foreground text-prose" 
                         dangerouslySetInnerHTML={{ 
                           __html: post.excerpt.rendered.length > 140
                             ? `${post.excerpt.rendered.substring(0, 140)}...`
                             : post.excerpt.rendered 
                         }} 
                      />
                    )}

                    <div className="flex items-center space-x-1.5 text-sm mt-4">
                      <BunnyImage
                        src="/images/badtz-avatar-small.webp"
                        alt="Author Avatar"
                        width={20}
                        height={20}
                        className="rounded-full bg-secondary shrink-0 h-5 w-5 invert dark:invert-[0]"
                      />
                      <p className="text-sm text-sidebar-muted-foreground">
                        {post.author_info ? post.author_info.name : "BadtzUI"}
                      </p>
                    </div>
                  </div>
                </article>
              </Link>
            ))}
          </div>
        ) : (
          <p>No posts published.</p>
        )}
      </div>

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLdBlog) }}
      />

      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLdPosts) }}
      />
    </div>
  );
}
```

### 2. Página de Post Individual

```tsx
import { notFound } from "next/navigation";
import Link from "next/link";
import { formatDate, absoluteUrl } from "@/lib/utils";
import { ChevronLeft } from "lucide-react";
import DocsCta from "@/components/docs/doc-cta";
import { DashboardTableOfContents } from "@/components/docs/article-toc";
import { getTableOfContents } from "@/lib/toc";
import { Icons } from "@/components/icons";
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from "@/components/ui/breadcrumb";
import BunnyImage from "@/components/bunny-image";
import { getPostBySlug, getRelatedPosts, getAllPosts } from "@/lib/wordpress";
import { Metadata } from "next";

type Params = {
  slug: string[];
};

export async function generateMetadata({ params }: { params: Params }): Promise<Metadata> {
  const slug = params?.slug?.join("/");
  const post = await getPostBySlug(slug);
  
  if (!post) {
    return {};
  }

  const url = process.env.NEXT_PUBLIC_APP_URL;
  const ogUrl = new URL(`${url}/api/og`);
  ogUrl.searchParams.set("heading", post.title.rendered);
  ogUrl.searchParams.set("type", "Blog Post");
  ogUrl.searchParams.set("mode", "dark");
  const postUrl = `https://www.badtz-ui.com/blog/${slug}`;

  return {
    title: post.title.rendered,
    description: post.excerpt.rendered.replace(/<[^>]*>/g, '').substring(0, 160),
    authors: post.author_info ? [{ name: post.author_info.name }] : [],
    alternates: {
      canonical: postUrl,
    },
  };
}

export async function generateStaticParams() {
  const posts = await getAllPosts();
  return posts.map((post) => ({
    slug: post.slug.split("/"),
  }));
}

export default async function PostPage({ params }: { params: Params }) {
  const slug = params?.slug?.join("/");
  const post = await getPostBySlug(slug);
  
  if (!post) {
    notFound();
  }
  
  // Se você tiver conteúdo em Markdown, pode usá-lo para TOC
  // Caso contrário, pode criar TOC a partir do HTML do WP
  const toc = post.content ? await getTableOfContents(post.content.rendered) : null;
  
  // Buscando posts relacionados
  const relatedPosts = await getRelatedPosts(post.id);

  // Schema JSON-LD para artigo
  const jsonLdArticle = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    mainEntityOfPage: {
      "@type": "WebPage",
      "@id": absoluteUrl(`/blog/${slug}`),
    },
    headline: post.title.rendered,
    description: post.excerpt.rendered.replace(/<[^>]*>/g, ''),
    image: post.featuredMedia ? post.featuredMedia.source_url : "/og-image.png",
    datePublished: post.date,
    dateModified: post.modified,
    author: {
      "@type": "Person",
      name: post.author_info ? post.author_info.name : "BadtzUI",
      url: post.author_info ? absoluteUrl(`/blog/authors/${post.author_info.slug}`) : absoluteUrl("/"),
    },
    publisher: {
      "@type": "Organization",
      name: "BadtzUI",
      logo: {
        "@type": "ImageObject",
        url: absoluteUrl("/logo.png"),
      },
    },
    articleSection: "Blog",
    url: absoluteUrl(`/blog/${slug}`),
  };

  // Schema JSON-LD para breadcrumbs
  const jsonLdBreadcrumbs = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
      {
        "@type": "ListItem",
        position: 1,
        name: "Home",
        item: "https://badtz-ui.com",
      },
      {
        "@type": "ListItem",
        position: 2,
        name: "Blog",
        item: "https://badtz-ui.com/blog",
      },
      {
        "@type": "ListItem",
        position: 3,
        name: "Article",
        item: `https://badtz-ui.com/blog/${slug}`,
      },
    ],
  };

  // Schema JSON-LD para artigos relacionados
  const jsonLdRelatedArticles = {
    "@context": "https://schema.org",
    "@type": "ItemList",
    name: "Related Articles",
    itemListElement: relatedPosts.map((related, index) => ({
      "@type": "ListItem",
      position: index + 1,
      name: related.title.rendered,
      url: absoluteUrl(`/blog/${related.slug}`),
    })),
  };

  return (
    <div className="w-full h-full pb-16">
      <div className="px-6 lg:px-8 lg:max-w-5xl mx-auto pt-10 md:pt-20 relative lg:gap-10 xl:grid xl:grid-cols-[1fr_240px]">
        <div className="max-w-xl mx-auto">
          <Link
            href="/blog"
            className="pl-3 pr-4 text-sm w-min mr-auto gap-2 px-2 md:pl-3 h-8 text-[13.5px] border hover:border-foreground/10 duration-300 whitespace-nowrap shrink-0 hover:bg-sidebar-accent transition-colors flex items-center justify-center rounded [&_svg]:pointer-events-none [&_svg]:size-3 [&_svg]:shrink-0 text-foreground bg-transparent mb-8"
          >
            <ChevronLeft />
            Back
          </Link>
          <Breadcrumb>
            <BreadcrumbList>
              <BreadcrumbItem>
                <BreadcrumbLink href="/">Home</BreadcrumbLink>
              </BreadcrumbItem>
              <BreadcrumbSeparator />
              <BreadcrumbItem>
                <BreadcrumbLink href="/blog">Blog</BreadcrumbLink>
              </BreadcrumbItem>
              <BreadcrumbSeparator />
              <BreadcrumbItem>
                <BreadcrumbPage>Article</BreadcrumbPage>
              </BreadcrumbItem>
            </BreadcrumbList>
          </Breadcrumb>
          <script
            type="application/ld+json"
            dangerouslySetInnerHTML={{
              __html: JSON.stringify(jsonLdBreadcrumbs),
            }}
          />
          <article className="w-full mt-3 [&_p]:font-light [&_li]:font-base [&_h3]:text-2xl max-w-xl mx-auto">
            <div className="flex flex-col items-start">
              <h1 className="text-4xl font-semibold tracking-tighter text-foreground text-balance font-gilroy mt-3">
                {post.title.rendered}
              </h1>
              {post.date && (
                <time
                  dateTime={post.date}
                  className="block text-xs text-muted-foreground mt-1"
                >
                  Published on {formatDate(post.date)}
                </time>
              )}
              {post.categories && post.categories.length > 0 && (
                <div className="mt-4 flex flex-wrap gap-2">
                  {post.categories.map((category) => (
                    <Link
                      key={category.id}
                      href={`/blog/categories/${category.slug}`}
                      className="px-3 py-0.5 text-xs bg-muted/70 rounded-full border border-border hover:bg-muted transition-colors mt-1"
                    >
                      {category.name}
                    </Link>
                  ))}
                </div>
              )}
            </div>
            <p className="text-muted-foreground text-balance mt-6"
               dangerouslySetInnerHTML={{ __html: post.excerpt.rendered }}
            />
            {post.featuredMedia && (
              <BunnyImage
                src={post.featuredMedia.source_url}
                alt={post.title.rendered}
                width={760}
                height={400}
                className="bg-secondary border border-border rounded-lg aspect-video object-cover w-full mb-6 mt-10"
                priority
              />
            )}
            <hr className="my-6 border-0" />
            <div 
              className="wordpress-content"
              dangerouslySetInnerHTML={{ __html: post.content.rendered }}
            />
            <script
              type="application/ld+json"
              dangerouslySetInnerHTML={{
                __html: JSON.stringify(jsonLdArticle),
              }}
            />
          </article>

          {post.author_info && (
            <div className="mt-1 flex space-y-4">
              <div className="w-full bg-secondary/20 border rounded-lg p-5 mt-12 flex text-left flex-col md:flex-row gap-8 items-start">
                <div className="flex flex-row w-full md:w-auto items-start md:flex-col gap-2 justify-between h-full">
                  <BunnyImage
                    src={post.author_info.avatar_url || "/images/badtz-avatar-small.webp"}
                    alt={post.author_info.name}
                    width={90}
                    height={90}
                    className="aspect-square object-cover bg-secondary border-border border rounded-full shrink-0"
                  />
                  <div className="flex items-center space-x-3">
                    <Link
                      href={post.author_info.url || "#"}
                      target="_blank"
                      title={`View ${post.author_info.name}'s profile`}
                      className="flex [&_svg]:size-3.5 items-center gap-2 rounded-md px-2 aspect-square justify-center h-8 w-8 text-sm border bg-secondary hover:border-foreground/10 transition-colors duration-300 whitespace-nowrap shrink-0"
                    >
                      <Icons.twitter />
                    </Link>
                  </div>
                </div>
                <div>
                  <h3 className="text-xl font-semibold mt-2">
                    Article written by{" "}
                    <Link
                      href={`/blog/authors/${post.author_info.slug}`}
                      className="hover:underline"
                      title={`View all articles by ${post.author_info.name}`}
                    >
                      {post.author_info.name}
                    </Link>
                  </h3>
                  <p className="text-muted-foreground text-pretty text-[15px] mt-3">
                    {post.author_info.description || `${post.author_info.name} is a contributor to BadtzUI.`}
                  </p>
                </div>
              </div>
            </div>
          )}
          <h3 className="mt-12 scroll-m-20 border-b pb-2 text-2xl font-semibold tracking-tight first:mt-0 font-gilroy mb-4">
            Related Articles
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-2 lg:gap-4">
            {relatedPosts.map((post, index) => (
              <Link
                href={`/blog/${post.slug}`}
                key={`related-${post.slug}`}
              >
                <article
                  className="flex flex-col w-full p-2 rounded-xl transition-colors duration-200 group/article"
                >
                  {post.featuredMedia && (
                    <BunnyImage
                      src={post.featuredMedia.source_url}
                      alt={post.title.rendered}
                      width={760}
                      height={400}
                      className="aspect-video object-cover bg-secondary border-border border rounded-lg"
                      priority={index <= 1}
                      quality={100}
                    />
                  )}
                  <div className="pt-2.5 p-1">
                    <h2 className="group-hover/article:text-foreground mt-2 font-medium transition-colors duration-300 text-xl text-sidebar-foreground font-gilroy">
                      {post.title.rendered}
                    </h2>
                    {post.date && (
                      <p className="text-xs text-sidebar-muted-foreground mt-1.5">
                        {formatDate(post.date)}
                      </p>
                    )}
                    <p className="mt-3 text-sm text-sidebar-muted-foreground text-prose"
                       dangerouslySetInnerHTML={{ 
                         __html: post.excerpt.rendered.length > 140
                           ? `${post.excerpt.rendered.substring(0, 140)}...`
                           : post.excerpt.rendered 
                       }}
                    />
                    <div className="flex items-center space-x-1.5 text-sm mt-4">
                      <BunnyImage
                        src="/images/badtz-avatar-small.webp"
                        alt="Author Avatar"
                        width={20}
                        height={20}
                        className="rounded-full bg-secondary shrink-0 h-5 w-5 invert dark:invert-[0]"
                      />
                      <p className="text-sm text-sidebar-muted-foreground">
                        {post.author_info ? post.author_info.name : "BadtzUI"}
                      </p>
                    </div>
                  </div>
                  <script
                    type="application/ld+json"
                    dangerouslySetInnerHTML={{
                      __html: JSON.stringify(jsonLdRelatedArticles),
                    }}
                  />
                </article>
              </Link>
            ))}
          </div>
          <div className="flex justify-center py-6 lg:py-10">
            <Link
              href="/blog"
              className="pl-3 pr-4 text-sm w-min mr-auto gap-2 px-2 md:px-3 h-8 text-[13.5px] border hover:border-foreground/10 duration-300 whitespace-nowrap shrink-0 hover:bg-sidebar-accent transition-colors flex items-center justify-center rounded [&_svg]:pointer-events-none [&_svg]:size-3 [&_svg]:shrink-0 text-foreground bg-transparent"
            >
              <ChevronLeft />
              All articles
            </Link>
          </div>
        </div>
        <div className="hidden text-sm xl:block">
          <div className="sticky top-20 -mt-6 max-h-[calc(100vh-3.5rem)] pt-4 overflow-y-auto">
            <DocsCta className="border-border dark:border-border" />
            <div className="h-full overflow-auto pb-10 pt-8">
              {toc && <DashboardTableOfContents toc={toc} />}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
```

### 3. Adicionar Biblioteca WordPress (Baseada no next-wp)

Vamos criar o arquivo para conectar ao WordPress:

```typescript
import querystring from "querystring";

// Configuração da API do WordPress
const baseUrl = process.env.WORDPRESS_URL;
const hostname = process.env.WORDPRESS_HOSTNAME;
const webhookSecret = process.env.WORDPRESS_WEBHOOK_SECRET;

if (!baseUrl) {
  console.warn(
    "WORDPRESS_URL não está definido. Necessário para chamadas da API do WordPress."
  );
}

// Função auxiliar para construir URLs da API
function getUrl(path: string, query?: Record<string, any>) {
  const params = query ? querystring.stringify(query) : null;
  return `${baseUrl}${path}${params ? `?${params}` : ""}`;
}

// Classe de erro para a API
class WordPressAPIError extends Error {
  constructor(message: string, public status: number, public endpoint: string) {
    super(message);
    this.name = "WordPressAPIError";
  }
}

// Função genérica de fetch para WordPress
async function wordpressFetch<T>(url: string): Promise<T> {
  const userAgent = "Next.js WordPress Client";

  const response = await fetch(url, {
    headers: {
      "User-Agent": userAgent,
    },
    next: {
      tags: ["wordpress"],
      revalidate: 3600, // 1 hora de cache
    },
  });

  if (!response.ok) {
    throw new WordPressAPIError(
      `WordPress API request failed: ${response.statusText}`,
      response.status,
      url
    );
  }

  return response.json();
}

// Tipos para os dados do WordPress
export interface Post {
  id: number;
  date: string;
  modified: string;
  slug: string;
  status: string;
  type: string;
  link: string;
  title: {
    rendered: string;
  };
  content: {
    rendered: string;
    protected: boolean;
  };
  excerpt: {
    rendered: string;
    protected: boolean;
  };
  author: number;
  author_info?: Author;
  featured_media: number;
  featuredMedia?: FeaturedMedia;
  categories: Category[];
  tags: Tag[];
}

export interface Author {
  id: number;
  name: string;
  url: string;
  description: string;
  slug: string;
  avatar_url: string;
}

export interface Category {
  id: number;
  name: string;
  slug: string;
  description: string;
}

export interface Tag {
  id: number;
  name: string;
  slug: string;
  description: string;
}

export interface FeaturedMedia {
  id: number;
  source_url: string;
  alt_text: string;
  media_details: {
    width: number;
    height: number;
    sizes: {
      [key: string]: {
        source_url: string;
        width: number;
        height: number;
      };
    };
  };
}

// Funções para buscar dados do WordPress

// Função para buscar todos os posts
export async function getAllPosts(filterParams?: {
  search?: string;
  author?: string;
  tag?: string;
  category?: string;
}): Promise<Post[]> {
  const params: Record<string, any> = {
    per_page: 100,
    _embed: "true", // incluir dados relacionados
  };

  // Adicionar filtros se fornecidos
  if (filterParams) {
    if (filterParams.search) params.search = filterParams.search;
    if (filterParams.author) params.author = filterParams.author;
    if (filterParams.tag) params.tags = filterParams.tag;
    if (filterParams.category) params.categories = filterParams.category;
  }

  const url = getUrl("/wp-json/wp/v2/posts", params);
  const posts = await wordpressFetch<Post[]>(url);

  // Processamento adicional para incluir dados incorporados
  return await Promise.all(
    posts.map(async (post) => {
      // Adicionar informações do autor
      if (post.author) {
        try {
          post.author_info = await getAuthorById(post.author);
        } catch (error) {
          console.warn(`Failed to fetch author for post ${post.id}`, error);
        }
      }

      // Adicionar mídia destacada
      if (post.featured_media) {
        try {
          post.featuredMedia = await getFeaturedMediaById(post.featured_media);
        } catch (error) {
          console.warn(
            `Failed to fetch featured media for post ${post.id}`,
            error
          );
        }
      }

      // Buscar categorias
      try {
        post.categories = await getCategoriesByPost(post.id);
      } catch (error) {
        console.warn(`Failed to fetch categories for post ${post.id}`, error);
        post.categories = [];
      }

      // Buscar tags
      try {
        post.tags = await getTagsByPost(post.id);
      } catch (error) {
        console.warn(`Failed to fetch tags for post ${post.id}`, error);
        post.tags = [];
      }

      return post;
    })
  );
}

// Função para buscar um post por slug
export async function getPostBySlug(slug: string): Promise<Post | null> {
  const url = getUrl("/wp-json/wp/v2/posts", { slug });
  const posts = await wordpressFetch<Post[]>(url);

  if (posts.length === 0) {
    return null;
  }

  const post = posts[0];

  // Adicionar informações adicionais
  if (post.author) {
    try {
      post.author_info = await getAuthorById(post.author);
    } catch (error) {
      console.warn(`Failed to fetch author for post ${post.id}`, error);
    }
  }

  if (post.featured_media) {
    try {
      post.featuredMedia = await getFeaturedMediaById(post.featured_media);
    } catch (error) {
      console.warn(`Failed to fetch featured media for post ${post.id}`, error);
    }
  }

  // Buscar categorias
  try {
    post.categories = await getCategoriesByPost(post.id);
  } catch (error) {
    console.warn(`Failed to fetch categories for post ${post.id}`, error);
    post.categories = [];
  }

  // Buscar tags
  try {
    post.tags = await getTagsByPost(post.id);
  } catch (error) {
    console.warn(`Failed to fetch tags for post ${post.id}`, error);
    post.tags = [];
  }

  return post;
}

// Função para buscar um post por ID
export async function getPostById(id: number): Promise<Post> {
  const url = getUrl(`/wp-json/wp/v2/posts/${id}`);
  return wordpressFetch<Post>(url);
}

// Função para buscar mídia destacada
export async function getFeaturedMediaById(id: number): Promise<FeaturedMedia> {
  const url = getUrl(`/wp-json/wp/v2/media/${id}`);
  return wordpressFetch<FeaturedMedia>(url);
}

// Função para buscar autor por ID
export async function getAuthorById(id: number): Promise<Author> {
  const url = getUrl(`/wp-json/wp/v2/users/${id}`);
  return wordpressFetch<Author>(url);
}

// Função para buscar categorias de um post
export async function getCategoriesByPost(postId: number): Promise<Category[]> {
  const url = getUrl(`/wp-json/wp/v2/categories`, { post: postId });
  return wordpressFetch<Category[]>(url);
}

// Função para buscar tags de um post
export async function getTagsByPost(postId: number): Promise<Tag[]> {
  const url = getUrl(`/wp-json/wp/v2/tags`, { post: postId });
  return wordpressFetch<Tag[]>(url);
}

// Função para buscar posts relacionados
export async function getRelatedPosts(postId: number): Promise<Post[]> {
  // Uma abordagem simples é buscar posts nas mesmas categorias
  const categories = await getCategoriesByPost(postId);
  if (categories.length === 0) {
    return [];
  }

  // Buscar posts na primeira categoria
  const url = getUrl("/wp-json/wp/v2/posts", {
    categories: categories[0].id,
    exclude: postId,
    per_page: 3,
    _embed: true,
  });

  const posts = await wordpressFetch<Post[]>(url);
  
  // Processar dados incorporados
  return await Promise.all(
    posts.map(async (post) => {
      if (post.author) {
        try {
          post.author_info = await getAuthorById(post.author);
        } catch (error) {
          console.warn(`Failed to fetch author for related post ${post.id}`, error);
        }
      }

      if (post.featured_media) {
        try {
          post.featuredMedia = await getFeaturedMediaById(post.featured_media);
        } catch (error) {
          console.warn(`Failed to fetch featured media for related post ${post.id}`, error);
        }
      }

      return post;
    })
  );
}

// Função para revalidar dados do WordPress
export async function revalidateWordPressData(tags?: string[]): Promise<void> {
  // Esta função seria usada com o endpoint de revalidação do Next.js
  // Por exemplo, chamando uma API interna que dispara a revalidação
  console.log("Revalidating WordPress data", tags || ["all"]);
}
```

### 4. API para Revalidação

```typescript
import { revalidatePath } from "next/cache";
import { NextRequest, NextResponse } from "next/server";

export const maxD

---

_**User**_

no caso quero usar a api do wordpress pra (modo serverless..)

---

_**Assistant**_

# Integração com WordPress API em Modo Serverless

Para usar a API do WordPress em um ambiente serverless com seu projeto BadtzUI, vamos criar uma implementação que funcione bem com Next.js e sua configuração de internacionalização atual.

## Implementação da API WordPress Serverless

Primeiro, vamos criar uma biblioteca para comunicação com o WordPress:

```typescript
import { cache } from 'react';

// Tipos para os dados da API WordPress
export interface WordpressPost {
  id: number;
  date: string;
  modified: string;
  slug: string;
  status: string;
  type: string;
  link: string;
  title: {
    rendered: string;
  };
  content: {
    rendered: string;
    protected: boolean;
  };
  excerpt: {
    rendered: string;
    protected: boolean;
  };
  author: number;
  featured_media: number;
  categories: number[];
  tags: number[];
  _embedded?: {
    author?: Array<{
      id: number;
      name: string;
      url: string;
      description: string;
      avatar_urls: Record<string, string>;
    }>;
    'wp:featuredmedia'?: Array<{
      id: number;
      source_url: string;
      alt_text: string;
      media_details: {
        width: number;
        height: number;
        sizes: Record<string, {
          source_url: string;
          width: number;
          height: number;
        }>;
      };
    }>;
    'wp:term'?: Array<Array<{
      id: number;
      name: string;
      slug: string;
      taxonomy: string;
    }>>;
  };
}

// Configure sua URL do WordPress aqui
const API_URL = process.env.WORDPRESS_API_URL || 'https://seu-site-wordpress.com/wp-json';

/**
 * Função para buscar dados da API WordPress com cache
 */
const fetchAPI = cache(async <T>(endpoint: string, params: Record<string, string> = {}): Promise<T> => {
  const queryString = new URLSearchParams(params).toString();
  const url = `${API_URL}${endpoint}${queryString ? '?' + queryString : ''}`;
  
  try {
    const res = await fetch(url, {
      headers: {
        'Content-Type': 'application/json',
      },
      next: {
        // Revalidar a cada 10 minutos
        revalidate: 600,
        tags: ['wordpress'],
      },
    });

    if (!res.ok) {
      throw new Error(`WordPress API Error: ${res.status} ${res.statusText}`);
    }

    return res.json();
  } catch (error) {
    console.error('Erro ao buscar dados do WordPress:', error);
    throw error;
  }
});

/**
 * Busca todos os posts do WordPress
 */
export const getAllPosts = cache(async (locale: string = 'pt-br', params: Record<string, string> = {}): Promise<WordpressPost[]> => {
  const defaultParams = {
    per_page: '10',
    _embed: 'true',
    lang: locale === 'en' ? 'en' : 'pt-br', // Supondo que você usa WPML ou Polylang
  };

  const mergedParams = { ...defaultParams, ...params };
  const posts = await fetchAPI<WordpressPost[]>('/wp/v2/posts', mergedParams);
  
  return posts;
});

/**
 * Busca um post específico por slug
 */
export const getPostBySlug = cache(async (slug: string, locale: string = 'pt-br'): Promise<WordpressPost | null> => {
  try {
    const params = {
      slug,
      _embed: 'true',
      lang: locale === 'en' ? 'en' : 'pt-br',
    };
    
    const posts = await fetchAPI<WordpressPost[]>('/wp/v2/posts', params);
    
    return posts.length > 0 ? posts[0] : null;
  } catch (error) {
    console.error(`Erro ao buscar post com slug "${slug}":`, error);
    return null;
  }
});

/**
 * Busca posts por categoria
 */
export const getPostsByCategory = cache(async (categoryId: number, locale: string = 'pt-br'): Promise<WordpressPost[]> => {
  const params = {
    categories: categoryId.toString(),
    _embed: 'true',
    lang: locale === 'en' ? 'en' : 'pt-br',
  };
  
  return fetchAPI<WordpressPost[]>('/wp/v2/posts', params);
});

/**
 * Busca categorias do WordPress
 */
export const getCategories = cache(async (locale: string = 'pt-br'): Promise<any[]> => {
  const params = {
    per_page: '100',
    lang: locale === 'en' ? 'en' : 'pt-br',
  };
  
  return fetchAPI<any[]>('/wp/v2/categories', params);
});

/**
 * Busca posts relacionados baseados em categorias ou tags
 */
export const getRelatedPosts = cache(async (postId: number, locale: string = 'pt-br'): Promise<WordpressPost[]> => {
  // Primeiro busca o post para obter suas categorias
  const post = await fetchAPI<WordpressPost>(`/wp/v2/posts/${postId}`, {
    _embed: 'false',
    lang: locale === 'en' ? 'en' : 'pt-br',
  });
  
  if (!post || !post.categories || post.categories.length === 0) {
    return [];
  }
  
  // Busca posts na mesma categoria principal
  const params = {
    categories: post.categories[0].toString(),
    exclude: postId.toString(),
    per_page: '3',
    _embed: 'true',
    lang: locale === 'en' ? 'en' : 'pt-br',
  };
  
  return fetchAPI<WordpressPost[]>('/wp/v2/posts', params);
});

/**
 * Utilidades para extrair dados de um post _embedded
 */
export const getPostAuthor = (post: WordpressPost) => {
  return post._embedded?.author?.[0] || null;
};

export const getPostFeaturedImage = (post: WordpressPost) => {
  return post._embedded?.['wp:featuredmedia']?.[0] || null;
};

export const getPostCategories = (post: WordpressPost) => {
  return post._embedded?.['wp:term']?.[0] || [];
};

export const getPostTags = (post: WordpressPost) => {
  return post._embedded?.['wp:term']?.[1] || [];
};
```

## Revalidação de Cache para Serverless

Agora, vamos implementar um endpoint para revalidação sob demanda (útil para webhooks do WordPress):

```typescript
import { revalidateTag } from 'next/cache';
import { NextRequest, NextResponse } from 'next/server';

export const runtime = 'edge'; // Para usar o Edge Runtime

export async function POST(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const secret = searchParams.get('secret');
    
    // Verifica a chave secreta para autenticação
    if (secret !== process.env.REVALIDATION_SECRET) {
      return NextResponse.json(
        { message: 'Token de autenticação inválido' },
        { status: 401 }
      );
    }

    // Revalida o cache dos dados do WordPress
    revalidateTag('wordpress');
    
    return NextResponse.json({ revalidated: true, now: Date.now() });
  } catch (error) {
    console.error('Erro durante revalidação:', error);
    return NextResponse.json(
      { message: 'Erro durante revalidação', error: (error as Error).message },
      { status: 500 }
    );
  }
}
```

## Implementação no Blog

Agora, vamos usar essa API em um componente de blog:

```typescript
import { notFound } from 'next/navigation';
import Link from 'next/link';
import { getAllPosts } from '@/lib/wordpress';
import { useTranslations } from 'next-intl';
import Image from 'next/image';

export const dynamic = 'force-dynamic';
export const revalidate = 3600; // Revalidação a cada hora

export default async function BlogPage({
  params: { locale }
}: {
  params: { locale: string }
}) {
  const t = useTranslations('blog');
  
  try {
    // Busca posts do WordPress com base no idioma atual
    const posts = await getAllPosts(locale);
    
    if (!posts || posts.length === 0) {
      return (
        <div className="container mx-auto py-10">
          <h1 className="text-3xl font-bold mb-6">{t('title')}</h1>
          <p>{t('no_posts')}</p>
        </div>
      );
    }
    
    return (
      <div className="container mx-auto py-10 px-4">
        <h1 className="text-3xl font-bold mb-6">{t('title')}</h1>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {posts.map(post => {
            const featuredImage = post._embedded?.['wp:featuredmedia']?.[0];
            
            return (
              <Link 
                key={post.id} 
                href={`/blog/${post.slug}`}
                className="border rounded-lg overflow-hidden hover:shadow-md transition-shadow"
              >
                {featuredImage && (
                  <div className="relative h-48 w-full">
                    <Image
                      src={featuredImage.source_url}
                      alt={post.title.rendered}
                      fill
                      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
                      className="object-cover"
                      priority={false}
                    />
                  </div>
                )}
                <div className="p-4">
                  <h2 
                    className="text-xl font-semibold mb-2" 
                    dangerouslySetInnerHTML={{ __html: post.title.rendered }}
                  />
                  <div 
                    className="text-gray-600 line-clamp-3"
                    dangerouslySetInnerHTML={{ __html: post.excerpt.rendered }}
                  />
                  <div className="mt-4 text-sm text-gray-500">
                    {new Date(post.date).toLocaleDateString(locale === 'en' ? 'en-US' : 'pt-BR')}
                  </div>
                </div>
              </Link>
            );
          })}
        </div>
      </div>
    );
  } catch (error) {
    console.error('Erro ao carregar blog:', error);
    return notFound();
  }
}
```

## Configuração de Ambiente

Adicione as seguintes variáveis de ambiente ao seu arquivo `.env.local`:

```
WORDPRESS_API_URL=https://seu-site-wordpress.com/wp-json
REVALIDATION_SECRET=seu_token_secreto_aqui
```

## Configuração no WordPress

Para que o sistema de revalidação funcione bem, você pode adicionar um webhook no WordPress que será disparado quando um post for publicado, atualizado ou excluído. Existem plugins como "WP Webhooks" que podem ajudar com isso.

Configure o webhook para chamar a sua URL de revalidação:
```
https://seu-site.com/api/revalidate?secret=seu_token_secreto_aqui
```

## Considerações sobre Internacionalização

Este sistema foi projetado para funcionar com sua configuração atual de internacionalização usando next-intl. O parâmetro `locale` é passado para as funções da API WordPress, que por sua vez podem ser mapeados para os códigos de idioma do seu site WordPress (supondo que você esteja usando um plugin como WPML ou Polylang).

Esta abordagem serverless permite que seu site busque conteúdo dinâmico do WordPress sem precisar de um servidor dedicado, sendo ideal para ambientes de hospedagem modernas como Vercel ou Netlify.

---

_**User**_

faça isso 

---

_**Assistant**_

Vou implementar a integração com a API do WordPress em modo serverless para o seu projeto BadtzUI. Vamos criar os arquivos necessários e configurar a estrutura corretamente. Vou implementar a integração com o WordPress em modo serverless para o seu projeto BadtzUI. Vamos executar isso em etapas:

## 1. Criando o arquivo de utilidades para WordPress ## 2. Criando o endpoint de revalidação da API ## 3. Implementando a página principal do blog Agora vamos atualizar a página principal do blog para usar o WordPress API: 
```

```
Vamos atualizar o restante da página do blog: 
```

```
Agora vamos atualizar a seção de listagem de posts: 
```

```

```

```

```

```
## 4. Atualizando a página de post individual

Agora, vamos atualizar a página de post individual para usar o WordPress: Copilot has been working on this problem for a while. It can continue to iterate, or you can send a new message to refine your prompt.

---

_**User**_

@agent Continue: "Continue to iterate?"

---

_**Assistant**_

Vamos continuar com a implementação da integração WordPress API em modo serverless para o seu projeto. Vamos atualizar a página individual do post para usar o WordPress API: 

---

